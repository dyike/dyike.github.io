<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 设计模式之“装饰者模式”——手机与包装盒示例 · 一刻笔记</title><meta name="description" content="设计模式之“装饰者模式”——手机与包装盒示例 - ityike"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.dyike.com/atom.xml" title="一刻笔记"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/learn" target="_self" class="nav-list-link">充电</a></li><li class="nav-list-item"><a href="/life" target="_self" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="http://weibo.com/yuanfengyff" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/dyike" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">订阅</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">设计模式之“装饰者模式”——手机与包装盒示例</h1><div class="post-info">Mar 29, 2017</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在“装饰模式”中很好的提现了开放关闭原则，即类应该对扩展开放对修改关闭。装饰者模式可以让我们在不对原来代码的修改的情况下对类进行扩展。现在我们举一个例子，就好比给生产好的手机进行包装，我们在对手机进行包装的过程不会去对手机进行任何修改，只管用盒子将盒子包装好就行。</p>
<p>装饰者模式，用另一种表达方式就是“对原有的物体进行装饰，给原有的物体添加上新的装饰品”。这里的例子就是，手机是被装饰者，包装盒就是装饰品。这样的话，可以看出装饰者模式就是“动态地将责任附加到对象上。若要扩展功能，装饰着提供了比继承更有弹性的替代方案。”</p>
<p>在“装饰者模式”中所使用的装饰就是变化的部分，也就是Decorator是变化的部分对应着我们的包装盒，因为对手机进行包装的过程就是包装盒变化的过程，也就是为手机装饰的过程。而手机就可以看做是组件。需要注意的是，所谓的装饰者不仅仅是给组件添加的新的装饰品。一个装饰者对象就是添加该装饰后的组件，也就是说装饰者=旧组件 + 新装饰品。</p>
<h2 id="手机-包装盒的具体实现"><a href="#手机-包装盒的具体实现" class="headerlink" title="手机+包装盒的具体实现"></a>手机+包装盒的具体实现</h2><h3 id="实现一个手机的接口PhoneInterface-php"><a href="#实现一个手机的接口PhoneInterface-php" class="headerlink" title="实现一个手机的接口PhoneInterface.php"></a>实现一个手机的接口<code>PhoneInterface.php</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">decorator</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PhoneInterface</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// 生产手机</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">product</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现一个装饰器抽象的基类Decorator-php"><a href="#实现一个装饰器抽象的基类Decorator-php" class="headerlink" title="实现一个装饰器抽象的基类Decorator.php"></a>实现一个装饰器抽象的基类<code>Decorator.php</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">decorator</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 装饰器抽象类</div><div class="line"> */</div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">PhoneInterface</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 产品生产线对象</div><div class="line">     * <span class="doctag">@var</span> Object</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> $phone;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(PhoneInterface $phone)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;phone = $phone;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 生产</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">product</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;phone-&gt;product();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">decorate</span><span class="params">($value)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现包装盒子的装饰器DecoratorPack-php"><a href="#实现包装盒子的装饰器DecoratorPack-php" class="headerlink" title="实现包装盒子的装饰器DecoratorPack.php"></a>实现包装盒子的装饰器<code>DecoratorPack.php</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">decorator</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 包装盒子装饰器</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecoratorPack</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $pack;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(PhoneInterface $phone)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;phone = $phone;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($name = <span class="string">''</span>, $value = <span class="string">''</span>)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;$name = $value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 生产</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">product</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;phone-&gt;product();</div><div class="line">        <span class="keyword">$this</span>-&gt;decorate(<span class="keyword">$this</span>-&gt;pack);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 进行包装</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">decorate</span><span class="params">($value = <span class="string">''</span>)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"使用&#123;$value&#125;进行了包装\n"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现各个装饰者-Decorator-这里是ApplePhone-php和SmartisanPhone-php"><a href="#实现各个装饰者-Decorator-这里是ApplePhone-php和SmartisanPhone-php" class="headerlink" title="实现各个装饰者(Decorator),这里是ApplePhone.php和SmartisanPhone.php"></a>实现各个装饰者(Decorator),这里是<code>ApplePhone.php</code>和<code>SmartisanPhone.php</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">decorator</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 苹果手机</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplePhone</span> <span class="keyword">implements</span> <span class="title">PhoneInterface</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">product</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"生产了一部苹果手机\n"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">decorator</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 锤子手机</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmartisanPhone</span> <span class="keyword">implements</span> <span class="title">PhoneInterface</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">product</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"生产了一部锤子手机\n"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="大差不差了，最后测试-test-php"><a href="#大差不差了，最后测试-test-php" class="headerlink" title="大差不差了，最后测试 test.php"></a>大差不差了，最后测试 <code>test.php</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 结构型模式</div><div class="line"> * 装饰器模式</div><div class="line"> * 对现有的对象增加功能，动态的将责任附加到对象上。</div><div class="line"> * 和适配器的区别： 适配器是链接两个接口，装饰器是对现有的对象包装</div><div class="line"> */</div><div class="line"><span class="comment">// 注册自加载</span></div><div class="line">spl_autoload_register(<span class="string">'autoload'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">autoload</span><span class="params">($class)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">require</span> dirname($_SERVER[<span class="string">'SCRIPT_FILENAME'</span>]) . <span class="string">'//..//'</span> . str_replace(<span class="string">'\\'</span>, <span class="string">'/'</span>, $class) . <span class="string">'.php'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">decorator</span>\<span class="title">DecoratorPack</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">decorator</span>\<span class="title">ApplePhone</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">decorator</span>\<span class="title">SmartisanPhone</span>;</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"为加装饰器之前： \n"</span>;</div><div class="line">    <span class="comment">// 生产苹果手机</span></div><div class="line">    $applePhone = <span class="keyword">new</span> ApplePhone();</div><div class="line">    $applePhone-&gt;product();</div><div class="line"></div><div class="line">    <span class="comment">// 生产锤子手机</span></div><div class="line">    $smartisanPhone = <span class="keyword">new</span> SmartisanPhone();</div><div class="line">    $smartisanPhone-&gt;product();</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> <span class="string">"\n------------\n"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> <span class="string">"进行包装装饰器: \n"</span>;</div><div class="line">    <span class="comment">// 初始化一个包装适配器</span></div><div class="line">    $decoratorPack1 = <span class="keyword">new</span> DecoratorPack(<span class="keyword">new</span> ApplePhone);</div><div class="line">    $decoratorPack1-&gt;pack = <span class="string">'白盒子'</span>;</div><div class="line">    $decoratorPack1-&gt;product();</div><div class="line"></div><div class="line">    $decoratorPack2 = <span class="keyword">new</span> DecoratorPack(<span class="keyword">new</span> SmartisanPhone);</div><div class="line">    $decoratorPack1-&gt;pack = <span class="string">'黑盒子'</span>;</div><div class="line">    $decoratorPack1-&gt;product();</div><div class="line"></div><div class="line">&#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</div><div class="line">    <span class="keyword">echo</span> $e-&gt;getMessage();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="运行结果：通过结果更清晰这个过程了"><a href="#运行结果：通过结果更清晰这个过程了" class="headerlink" title="运行结果：通过结果更清晰这个过程了"></a>运行结果：通过结果更清晰这个过程了</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">为加装饰器之前：</div><div class="line">生产了一部苹果手机</div><div class="line">生产了一部锤子手机</div><div class="line"></div><div class="line">------------</div><div class="line">进行包装装饰器:</div><div class="line">生产了一部苹果手机</div><div class="line">使用白盒子进行了包装</div><div class="line">生产了一部苹果手机</div><div class="line">使用黑盒子进行了包装</div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2017/04/11/inversion-of-control/" class="prev">上一篇</a><a href="/2017/03/27/design-pattern-strategy/" class="next">下一篇</a></div><div class="copyright"><p>© 2013 - 2017 <a href="http://www.dyike.com">ityike</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>