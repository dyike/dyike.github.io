<div class="analytics"><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_XXXXXXXXXX'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3DXXXXXXXXXX%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></div><!DOCTYPE html><html lang="zh_CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="php、nginx、mysql、swift、程序员、arduino、硬件、软件"><title>用 Vagrant 管理虚拟机 | 一刻笔记</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">用 Vagrant 管理虚拟机</h1><a id="logo" href="/.">一刻笔记</a><p class="description">带着一颗变态的、积极的心走向未来</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/learn/"><i class="fa fa-plug"> 充电</i></a><a href="/life/"><i class="fa fa-life-ring"> 生活</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-hand-peace-o"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">用 Vagrant 管理虚拟机</h1><div class="post-meta">Sep 20, 2015<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>Vagrant 可以让我们用命令直接从云上下载虚拟机的镜像，你想要什么系统都行，Centos，Ubuntu …   只需要一行命令，然后再用命令去操作虚拟机，启动，暂停，关闭，重启，你可以更方便的管理所有的在本地上电脑上的虚拟机镜像，手工去配置它们，可以再重新打包成新的镜像，方便你跟你的团队在其它的项目上重复使用。</p>
<h2 id="安装-Vagrant"><a href="#安装-Vagrant" class="headerlink" title="安装 Vagrant"></a>安装 Vagrant</h2><p>Vagrant 提供了一个虚拟机的管理层，虚拟机本身还是需要用到虚拟机的软件，比如 VMware，Virtualbox 等等，推荐用 Virtualbox 。使用系统的包管理工具去安装软件。</p>
<p>###</p>
<h3 id="Mac-上安装-Vagrant"><a href="#Mac-上安装-Vagrant" class="headerlink" title="Mac 上安装 Vagrant"></a>Mac 上安装 Vagrant</h3><p>[cce]brew install vagrant[/cce]</p>
<h3 id="Mac-上安装-Virtualbox"><a href="#Mac-上安装-Virtualbox" class="headerlink" title="Mac 上安装 Virtualbox"></a>Mac 上安装 Virtualbox</h3><p>[cce]brew install Caskroom/cask/virtualbox[/cce]</p>
<h2 id="Box"><a href="#Box" class="headerlink" title="Box"></a>Box</h2><p>Box ，你可以把它想成是一个箱子，里面装了一些东西。在用 Vagrant 创建虚拟机的时候，需要用到 Box ，它里面会包装操作系统的镜像，不同的 Box 带的操作系统可能是不一样的，比如 CentOS，Ubuntu 等等，你可以基于它们去创建自己版本的 Box，比如在虚拟机上安装一些软件，然后把它重新打包成 Box 。</p>
<p>在 Vagrant 提供的云服务（<a href="https://vagrantcloud.com/" target="_blank" rel="external">https://vagrantcloud.com/</a>）上面可以下载到别人做好的 Box，这个云服务现在叫 Atlas，是 hashicorp 公司的一个产品，Vagrant 也是这家公司的项目。打开这个地址以后，可以去搜索想要用的 Box，可以搜索操作系统的名字，也可以搜索特定的软件的名字，比如 Laravel，Drupal …    在搜索结果上面会显示这个 Box 的下载的次数，你可以用来判断这个 Box 是否受欢迎。</p>
<p>我们需要一个纯净的 Box，就是只包含操作系统，在系统上没有安装其它的多余的东西。注意不同发行版的 Linux 操作起来是有些区别的，我推荐先用一下 CentOS 这款操作系统。</p>
<h3 id="添加-Box"><a href="#添加-Box" class="headerlink" title="添加 Box"></a>添加 Box</h3><p>你要把 Box 下载到本地的电脑上，交给 Vagrant 去管理，这样在创建虚拟机的时候，Vagrant 会复制一份你指定的 Box 到你的项目里面，这样你在这个虚拟机上的操作，就不会影响到其它的项目。先确定你用的电脑上的操作系统的位数，现在一般都是 64 位的操作系统。打开命令行工具以后，执行 vagrant box add 命令去添加 Box 。<br>[cce]vagrant box add 名字[/cce]<br>如果你指定的 Box 在本地电脑上不存在，Vagrant 就会到它的云上去给你下载。执行：<br>[cce]vagrant box add chef/centos-6.5[/cce]<br>上面的 chef/centos-6.5 还有 centos-6.5-i386 就是想要添加的 Box 的名字，最前面的 chef  ，是一个命名空间，一般就是这个 Box 的作者的名字，后面的 centos-6.5 表示这个 Box 的操作系统是 CentOS ，版本是 6.5 ，i386 表示 32 位的系统。</p>
<h3 id="查看本地上的-Box-列表"><a href="#查看本地上的-Box-列表" class="headerlink" title="查看本地上的 Box 列表"></a>查看本地上的 Box 列表</h3><p>完成以后，可以查看一下在本地上的 Box 列表。<br>[cce]vagrant box list[/cce]</p>
<h3 id="手工下载并添加-Box-的方法"><a href="#手工下载并添加-Box-的方法" class="headerlink" title="手工下载并添加 Box 的方法"></a>手工下载并添加 Box 的方法</h3><p>在执行 Vagrant box add 添加 Box 的时候，Vagrant 会在命令行上显示 Box 的下载地址，下载的速度还有进度，如果你在国内，很可能下载的速度非常慢。你可以复制 Box 的下载地址，然后用下载工具，比如用迅雷去下载。</p>
<p>完成以后，找到下载下来的文件，文件名里会包含 .box 这个扩展名，如果不是，你需要手工添加这个扩展名。并且重命名一下文件，比如命名为 centos_6.5.box 。然后把它放到桌面上，其它地方也行。打开命令行，进入到手工下面的 Box 文件所在的位置。比如<br>[cce]cd ~/ityike[/cce]<br>然后查看一下文件列表：<br>[cce]ls[/cce]<br>确定 Box 文件在当前的目录的下面，再执行 vagrant box add 命令去手工添加 Box 。<br>[cce]vagrant box add 名称 路径[/cce]<br>名称就是你想给这个 Box 起的名字，以后我们会用到这个名字去管理这个 Box，路径是 Box 文件所在的位置，如果你要添加的 Box 直接在你当前所在的目录的下面，可以直接使用 Box 文件的名称，像这样：<br>[cce]vagrant box add centos-6.5 centos-6.5.box[/cce]<br>Vagrant 会把 Box 文件复制到系统的某个特定的目录的下面，完成以后，你就可以把桌面上的 Box 文件删除掉了。<br>[cce]rm centos-6.5.box[/cce]<br>再查看一下可用的 Box 列表：<br>[cce]vagrant box list[/cce]<br>在返回的列表里，你应该可以找到自己手工添加的 centos-6.5 这个 Box 。</p>
<h3 id="管理-Box"><a href="#管理-Box" class="headerlink" title="管理 Box"></a>管理 Box</h3><p>添加到本地电脑上的 Box 会放到一个特定的目录的下面。跟 Box 相关的命令，可以用 vagrant box 命令查看。使用的方法就是 vagrant box 后面再加上子相应的子命令，接着是对应的参数。常用的就是 add ，list 还有 remove。add 是添加新的 Box ，list 可以查看已有的 Box ，remove 就是从系统中删除掉 Box 。注意在创建虚拟机的时候，Vagrant 会把你指定的 Box 复制一份放到特定的目录的下面。所以，你在使用 remove 命令删除掉添加到系统中的 Box 的时候，不会影响到这些已有的虚拟机。</p>
<h2 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h2><p>添加了 Box 以后，我们就可以用 Vagrant 基于这个 Box 去创建虚拟机了。先找个地方去创建一个目录，这个目录就是你的项目所在的目录，它会自动跟虚拟机上的某个目录同步，也就是在你电脑上的这个目录里面的文件，你同样可以在虚拟机里的某个目录里面找到。比如我要在桌面上创建一个叫 ninghao-project 的目录，然后再进入到这个目录，在命令行工具下面执行：<br>[cce]<br>cd ~/ityike<br>mkdir ityike-project<br>cd ityike-project<br>[/cce]</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>首先要做的就是初始化一下，用 vagrant init ，后面指定一下要使用的 Box 的名字。完成以后，在你的目录下面创建一个叫 Vagrantfile 的文件。</p>
<p>先查看一下可用的 Box<br>[cce]vagrant box list[/cce]<br>如果跟着我的步骤来，你应该可以看到一个叫 centos-6.5 的 Box 。下面我们用这个 Box 去初始化一下项目。<br>[cce]vagrant init centos-6.5[/cce]<br>完成以后，查看一下当前目录下面的东西。<br>[cce]ls[/cce]<br>你会看到一个 Vagrantfile 文件，这个文件是配置当前项目的虚拟机用的，以后我们会再回来看一下怎么样使用这个文件。</p>
<h3 id="启动虚拟机"><a href="#启动虚拟机" class="headerlink" title="启动虚拟机"></a>启动虚拟机</h3><p>Vagrant 提供了一些命令可以操作虚拟机，比如启动，暂停，关闭或者销毁虚拟机。启动虚拟机，执行：<br>[cce]vagrant up[/cce]</p>
<p><pre><span style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; line-height: 1.5;">第一次启动，花的时间会长一些，因为 Vagrant 会把你为项目指定的 Box 复制到一个地方，然后再去启动它。完成以后，你可以用命令再查看一下虚拟机的状态：</span></pre><br>[cce]vagrant status[/cce]<br>如果返回的是 running ，说明虚拟机启动成功，现在你就可以使用 ssh 连接到虚拟机，去控制它了。</p>
<h3 id="控制虚拟机"><a href="#控制虚拟机" class="headerlink" title="控制虚拟机"></a>控制虚拟机</h3><p>想在 Linux 系统的虚拟机上进行操作，你要用 ssh 连接到虚拟机，这跟你远程控制 Linux 的服务器是一样的。</p>
<h4 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h4><p>[cce]vagrant ssh[/cce]</p>
<h3 id="暂停与恢复"><a href="#暂停与恢复" class="headerlink" title="暂停与恢复"></a>暂停与恢复</h3><p>虚拟机在运行的时候会消耗你的电脑资源，比如内存，CPU 等等，在不用它的时候，可以关掉或者使用暂停，暂停虚拟机可以保存虚拟机运行时候的状态，暂停以后，除了占点硬盘空间以外，就不会消耗你的其它资源了。</p>
<p>进入到项目所在的目录，然后可以用 vagrant status 查看一下当前的虚拟机的状态，如果是 running ，你就可以使用命令去暂停一下：<br>[cce]vagrant suspend[/cce]<br>重新恢复起动，执行命令：<br>[cce]vagrant resume[/cce]<br>想要彻底关掉虚拟机的运行，执行：<br>[cce]vagrant halt[/cce]<br>停止以后，要想再起动虚拟机，要执行：<br>[cce]vagrant up[/cce]</p>
<h3 id="删除虚拟机"><a href="#删除虚拟机" class="headerlink" title="删除虚拟机"></a>删除虚拟机</h3><p>不打算再用的虚拟机，可以把它删除掉，直接删除项目的目录是不行的，因为为项目指定的虚拟机并不包含在这个项目的目录下面，需要使用命令去删除虚拟机。进入到项目所在目录，然后执行：<br>[cce]vagrant destroy[/cce]</p>
<hr>
<h3 id="配置共享目录"><a href="#配置共享目录" class="headerlink" title="配置共享目录"></a>配置共享目录</h3><p>打开 Vagrantfile ，搜索一下共享目录的配置：<br>[cce]# config.vm.synced_folder[/cce]<br>去掉这行代码前面的 # 符号 。这个配置后面有两个参数，第一个参数是主机上的目录，可以使用绝对的位置，也可以使用相对的位置，如果是相对位置，是相对于项目根目录的位置，也就是相对于 Vagrantfile 这个文件所在的目录的位置。两个参数之间是一个逗号，第二个参数是在虚拟机上的目录，如果你设置的目录在虚拟机上不存在，Vagrant 在启动虚拟机的时候，会自动去创建这个目录。<br>比如：<br>[cce]config.vm.synced_folder “app”, “/vagrant”[/cce]</p>
<h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><p>然后搜索：<br>[cce]</p>
<h1 id="config-vm-network-“forwarded-port”-guest-80-host-8080-cce"><a href="#config-vm-network-“forwarded-port”-guest-80-host-8080-cce" class="headerlink" title="config.vm.network “forwarded_port”, guest: 80, host: 8080[/cce]"></a>config.vm.network “forwarded_port”, guest: 80, host: 8080[/cce]</h1><p>去掉这行代码最前面的 # 号， 这个配置就是端口转发</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.dyike.com/2015/09/20/Vagrant管理虚拟机/" data-id="cin3a29hu0009n7t7xxq3vj5g" class="article-share-link">分享到</a><div class="tags"><a href="/tags/vagrant-virtualbox/">vagrant virtualbox</a></div><div class="post-nav"><a href="/2015/10/22/讨论下redis集群方案以及遇到过的坑/" class="pre">讨论下redis集群方案以及遇到过的坑</a><a href="/2015/09/19/记一次错误/" class="next">由于自己的疏忽，一个低级的错误</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/内心OS/" style="font-size: 15px;">内心OS</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/虚拟机/" style="font-size: 15px;">虚拟机</a> <a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/vagrant-virtualbox/" style="font-size: 15px;">vagrant virtualbox</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/数据结构-算法-干货分享/" style="font-size: 15px;">数据结构  算法  干货分享</a> <a href="/tags/PM-创业者-工具-服务-我的收藏/" style="font-size: 15px;">PM 创业者 工具 服务 我的收藏</a> <a href="/tags/回忆录/" style="font-size: 15px;">回忆录</a> <a href="/tags/支付功能/" style="font-size: 15px;">支付功能</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/04/15/为什么要到hexo上搭建一个blog/">为什么要到hexo上搭建一个blog</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/02/php7编译出的错误/">php7编译出现的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/30/2015年总结/">2015年我的总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/22/讨论下redis集群方案以及遇到过的坑/">讨论下redis集群方案以及遇到过的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/20/Vagrant管理虚拟机/">用 Vagrant 管理虚拟机</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/19/记一次错误/">由于自己的疏忽，一个低级的错误</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/16/Centos7下开发环境的配置/">Centos7下配置nginx，mysql，php环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/04/科学上网/">科学上网：用VPS搭建shadowsocks服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/08/2015年8月8日晚记/">2015年8月8日晚小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/04/业余学习/">【08-03】业余时间怎么充电？技术管理的进阶，有哪些初和中级书籍，工具？技术思想怎么提升和实践？</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.chenjie.info/" title="陈捷的博客" target="_blank">陈捷的博客</a><ul></ul><a href="http://www.iamle.com/" title="流水理鱼wwek" target="_blank">流水理鱼wwek</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">一刻笔记.</a> ityike <a rel="nofollow" target="_blank" href="http://www.dyike.com"></a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>